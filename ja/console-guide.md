## Management > Service Monitoring > コンソール使用ガイド

## サービス管理

モニタリングするサービス、障害を配信する対象とチャンネルなどを管理できます。

### サービス追加
- サービスごとにモニタリングを登録し、障害の配信、管理を行います。したがってサービスを論理的に区分し、管理できるようにサービス一覧を提供します。
- サービス一覧上部の**+追加**ボタンをクリックすると、サービスを追加できます。

### 配信設定
- 障害の配信を受信する担当者を設定します。 
- プロジェクトメンバーに登録されたユーザーのみ登録できます。
- 先にグループを登録し、グループ別担当者、受信するチャンネルを選択します。

### 配信グループ
- 複数の配信グループを登録した場合、最初に障害を検知した場合
  - 最初のグループにのみ障害が配信されます。最初のグループのユーザーが**配信状況**ページで次のグループに配信(追加の障害配信)または配信中止(障害ではない)を選択できます。
  - 3時間、発生した障害を処理しない場合、自動的に次のグループに障害が配信されます。

- 1つのグループのみ登録している場合
  - 障害が1つのグループにのみ配信され、終了します。

- グループを登録していない場合
  - 障害が配信されず、配信状況にも登録されません。


### 配信チャンネル
1. **Email**
   - 会員情報に登録したIDを基準に、障害をメールで配信します。
2. **SMS**
   - 会員情報に携帯電話番号を登録している場合、障害をSMSで配信します。
3. **Webフック** 
   - ユーザーの要求に合わせて、障害発生時に動作するHTTP APIを登録すると、障害発生時に該当APIを呼び出すWebフック機能を提供します(例：GitHubイシュー登録およびSlack連携など)。障害検知内容、サービス名、シナリオ名など、検知した障害に関する情報は、定義されている変数に置換されてURL、ヘッダ、リクエストデータで使用でき、障害配信時に置換されて配信されます。
   - URL、Webフックヘッダ、リクエストデータ入力エディタで、自動コンプリート(Ctrl + Space)機能を使用し、定義されている変数を確認し、使用することができます。


## 配信状況
- 検知および配信された障害履歴を確認できます。
- 次のグループに障害を配信または配信を中止する機能を使用できます。

## Webモニタリング
HTTP、HTTPSでサービスを提供するすべてのWebサービスをモニタリングできます。

### シナリオタイプ
- **APIタイプ** 
    - REST APIをモニタリングします。
    - 最短60秒周期でシナリオを登録できます。
- **仮想ブラウザタイプ** 
    - 仮想ブラウザを活用してWebページをモニタリングします。 
    - ユーザー指定JavaScriptを登録して、ページの動作をモニタリングできます。
    - モジュールタイプシナリオを含めることができ、モジュールタイプシナリオを順番に先に実行した後にシナリオを実行します。モジュールおよび仮想ブラウザシナリオ間のセッションおよびCookieは共有され、これを活用してログイン後のページの動作などをテストできます。
    - 最短120秒周期でシナリオを登録できます。
- **モジュールタイプ** 
    - 複数のシナリオで共通して必要な機能(ログインなど)を提供します。 
    - モジュールタイプ単独で動作できず、仮想ブラウザタイプに含まれて動作します。

### シナリオ検証

シナリオの検証方式は次のとおりです。

| 検証方式 | 説明 | 基本設定 | 備考 |
| -- | -- | -- | -- |
| レスポンスコード | HTTPレスポンスコード検証 | 200 | |
| タイムアウト | リクエスト後、レスポンス時間まで検証 | 5000 (ms) ||
| テキスト検証 | レスポンスデータ(画面)に特定テキストが存在するかどうかを検証 | なし | JsonPath、XPathサポート |
| イメージ検証 | レスポンス画面にイメージが存在するか、ダウンロード可能かどうかを検証 | なし | モジュール、仮想ブラウザタイプのみサポート |
| 配信除外検証 | レスポンスデータ(画面)に特定テキストが存在する場合、障害を配信しない | なし | メンテナンス時に使用 |

#### JsonPathを使用してテキスト検証する時、配列データに対する関数をサポート
| 関数 | 説明 | 出力タイプ |
| -- | -- | -- |
| min() | 配列データ中の最小値 | double | 
| max() | 配列データ中の最大値 | double | 
| sum() | 配列データの合計 | double | 
| avg() | 配列データの平均値 | double | 
| stddev() | 配列データの標準偏差 | double | 
| length() | 配列データの数 | integer | 

## TCPモニタリング

TCP、UDP、ICMPプロトコルを活用してモニタリングできます。

### シナリオタイプ
- **ICMPタイプ**
  - サーバーの状態をモニタリングするためのpingテストを進行できます。

- **TCPタイプ**、**UDPタイプ**
  - IP：Portに接続した後、データを転送し、レスポンスを受けるプロセスをテストし、返されたデータを検証します。
  - IP：Portの状態を確認する用途でも使用できます。

## バッチモニタリング

Webモニタリング、TCPモニタリングとは異なり、Service Monitoringで直接モニタリングを行うのではなく、Service Monitoringで提供するAPIをユーザーが呼び出し、APIのデータをService Monitoringで検証して、障害かどうかを判断します。

### 検証方式
- 内容検証
  - ユーザーが事前に登録したシナリオで、実際にユーザーが転送したデータと比較して障害かどうかを判断します。
  - JsonPath(https://goessner.net/articles/JsonPath/)方式を使用して、シナリオデータと実際のデータを比較します。
- 回数検証
  - 特定時間中のユーザーのリクエスト回数を確認し、ユーザーが設定した回数と比較して障害かどうかを判断します。


### 使用例
    - ビルドサーバーのビルド結果をバッチモニタリングに転送して、ビルド結果をモニタリングできます。
    - 毎日バッチを実行した後にバッチモニタリングAPIを呼び出し、毎日バッチの成否および動作をモニタリングできます。


## 配信管理
- **一時的配信中止**にしている配信のように、すでに認知している障害の場合は、障害が発生しても障害と判断しないようにする機能です。
- **一時的配信中止**は、モニタリングごとに設定できます。
- 開始時間と終了時間を設定でき、設定した時間が経過した後に障害が発生すると、設定された配信グループに障害が配信されます。
